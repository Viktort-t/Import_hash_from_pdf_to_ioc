[English version](README_en.md)

# Обработка хэшей и генерация IOC

Этот проект извлекает хэши из указанного PDF-файла, фильтрует их с использованием кэша и генерирует файлы IOC (Indicator of Compromise) в формате XML. Программа поддерживает индикацию прогресса для большей прозрачности выполнения.

## Возможности
- Извлечение текста из PDF-файлов с использованием `PyMuPDF`.
- Определение хэшей (MD5, SHA1, SHA256, SHA512) с помощью регулярных выражений.
- Проверка хэшей через API Kaspersky OpenTIP с использованием кэша для повышения производительности.
- Параллельная проверка хэшей с использованием `ThreadPoolExecutor`.
- Генерация IOC-файлов в формате XML и их разделение, если размер превышает 2 МБ.
- Индикация прогресса выполнения с использованием `tqdm`.

## Требования
### Зависимости
- Python 3.7+
- Установите необходимые пакеты:
  ```bash
  pip install -r requirements.txt
  ```

### Библиотеки
- `PyMuPDF` для извлечения текста из PDF
- `tqdm` для индикации прогресса
- `requests` для взаимодействия с API
- `concurrent.futures` для параллельной обработки

## Использование
### 1. Подготовьте входные данные
Поместите PDF-файл, который необходимо обработать, в выбранную директорию и запомните путь к нему.

### 2. Настройте параметры
В функции `main()`:
- Укажите полный путь к вашему PDF-файлу в переменной `pdf_path`.
- При необходимости измените директорию вывода, обновив `output_directory`.

### 3. Запустите скрипт
Выполните скрипт с помощью Python:
```bash
python main.py
```

### Результат
- Извлечённые и отфильтрованные хэши сохраняются в текстовых файлах.
- Сгенерированные IOC-файлы сохраняются в формате XML в указанной директории вывода.

## Структура проекта
```plaintext
project/
├── main.py                 # Основной скрипт для обработки PDF в IOC-файлы
├── requirements.txt        # Необходимые Python-пакеты
├── output_ioc/             # Директория вывода для сгенерированных IOC-файлов
├── test/                   # (Опционально) Директория для тестовых файлов и данных
└── README.md               # Документация проекта
```

## Пример использования
### Входной PDF
Путь: `C:\Users\User\Documents\sample.pdf`

### Конфигурация
```python
pdf_path = r"C:\Users\User\Documents\sample.pdf"
output_directory = "output_ioc"
```

### Выполнение
```bash
python main.py
```

### Результат
```
Извлечение текста из PDF: 100%|████████████████████| 10/10 [00:02<00:00,  4.12it/s]
Проверка хэшей: 100%|███████████████████████████| 100/100 [00:05<00:00, 18.05it/s]
Создано 2 IOC-файлов.
```
Файлы, созданные в директории `output_ioc/`:
- `sample_hashes.txt`
- `sample_<UUID>.ioc`

## Настройка
- **Индикация прогресса**: Измените параметры `desc` в вызовах `tqdm`, чтобы настроить метки прогресса.
- **Параллелизм**: Настройте параметр `max_workers` в `ThreadPoolExecutor` для оптимальной производительности на вашей системе.
- **Максимальный размер файла**: Обновите параметр `max_file_size` в функции `split_and_save_ioc()` для задания других ограничений на размер файла.

## Устранение неполадок
- **Отсутствуют зависимости**: Убедитесь, что все необходимые библиотеки установлены с помощью `pip install -r requirements.txt`.
- **Ошибки API**: Проверьте подключение к интернету и доступность API Kaspersky OpenTIP.
- **Большие файлы**: Для очень больших PDF-файлов рассмотрите возможность увеличения системных ресурсов или оптимизации числа параллельных потоков.

## Вклад в проект
Вы можете вносить вклад в проект, открывая задачи или отправляя pull-запросы. Для серьёзных изменений, пожалуйста, сначала обсудите ваши идеи.

## Лицензия
Этот проект лицензирован под лицензией MIT. Подробнее см. файл LICENSE.

